boimport React, { useState, useEffect, useRef } from 'react';

// --- Helper Data & Components ---

const moduleData = {
  title: "Module 3: Coding with Generative AI",
  tools: [
    { name: "ChatGPT Canvas", url: "https://chat.openai.com/" },
    { name: "Gemini Canvas", url: "https://gemini.google.com/" },
    { name: "Claude Artifact", url: "https://claude.ai/" }
  ],
  goal: "Learn how to create and run websites, web apps, and multimedia pages directly in AI tools — no external software needed.",
  sections: [
    {
      id: 1,
      title: "How Coding with AI Works",
      icon: "✨",
      content: [
        "Choose what you want to build — a simple website, an interactive web app, or a page with multimedia (images, audio, video).",
        "Write a clear prompt — describe what you want, and include important details like layout, colors, and features.",
        "Paste your prompt into an AI tool like ChatGPT Canvas, Gemini Canvas, or Claude Artifact.",
        "Click 'Preview' — the tool will generate the code and show your project live.",
        "Adjust and improve — add more features or change the design by refining your prompt."
      ]
    },
    {
      id: 2,
      title: "Understanding the Building Blocks",
      icon: "🧱",
      content: [
        { term: "HTML (Structure)", definition: "The skeleton of your page. It decides what’s on the page, like text, images, headings, and links." },
        { term: "CSS (Style)", definition: "The clothing and appearance. It decides how the page looks, including colors, fonts, spacing, and layout." },
        { term: "JavaScript (Interaction)", definition: "The brain and muscles. It makes your page do things, like making buttons work, playing animations, or saving data from forms." },
      ],
      note: "You don’t need to be an expert in these. The AI writes the code for you when you provide a good prompt!"
    },
    {
      id: 3,
      title: "Prompt Templates & Keywords",
      icon: "📝",
      content: [
        {
          type: "A. Static Website (Simple Pages)",
          use: "Portfolios, company pages, product info.",
          keywords: ["responsive design", "single-page", "header", "navigation", "footer", "hero section", "color scheme", "Google Fonts", "mobile-friendly"],
          template: 'Create a single-page responsive website with a hero section, about section, services section, and contact form. Use a [color scheme] and [font].'
        },
        {
          type: "B. Web App (Interactive Pages)",
          use: "Tools, games, calculators, to-do lists.",
          keywords: ["interactive", "dynamic", "JavaScript functionality", "user input", "form validation", "real-time updates", "clean layout"],
          template: 'Build a responsive [type of app] with an input field, buttons, and saved data. Use a minimalist design.'
        },
        {
          type: "C. Multimodal Page (Text + Media)",
          use: "Travel guides, online courses, product showcases.",
          keywords: ["embed images", "audio", "video", "captions", "interactive gallery", "slideshow", "multilingual support"],
          template: 'Create an interactive page with [media types], captions, and a responsive layout.'
        }
      ]
    },
    {
      id: 4,
      title: "Practice Tasks",
      icon: "✅",
      content: [
        "Use the Static Website template to make a personal portfolio.",
        "Use the Web App template to create a simple tool (e.g., a to-do list).",
        "Use the Multimodal template to make a travel guide with images and audio.",
        "Open Preview and test your project — adjust your prompts until you’re happy with the result."
      ]
    },
    {
      id: 5,
      title: "Self-Check Before Moving On",
      icon: "🤔",
      isQuiz: true,
      content: [
        { question: "Can you explain what HTML, CSS, and JavaScript do in your own words?", id: "q1" },
        { question: "Can you list three keywords for each type of coding project (Static, Web App, Multimodal)?", id: "q2" },
        { question: "Have you successfully created at least one project in Preview mode?", id: "q3" }
      ],
      conclusion: "If you can answer “yes” to all, you’re ready for the final project!"
    },
    {
      id: 6,
      title: "Final Project",
      icon: "🏆",
      content: [
        "Pick one type of project: a Static Website, a Web App, or a Multimodal Page.",
        "Write your own unique prompt using at least 5 keywords from the lists provided earlier.",
        "Generate your project in an AI Canvas or Artifact tool.",
        "Preview and refine your project until it's complete and you're proud of it.",
        "Share your final project preview!"
      ]
    }
  ]
};

// --- Icon Component (for certificate buttons) ---
const Icon = ({ name, className }) => {
  const icons = {
    ChevronUp: <path d="m18 15-6-6-6 6"/>,
    ChevronDown: <path d="m6 9 6 6 6-6"/>,
    CheckCircle: <><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></>,
    X: <path d="M18 6 6 18M6 6l12 12"/>,
    Download: <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" />,
  };
  return <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{icons[name] || <path/>}</svg>;
};

// --- Component to load external scripts and styles ---
const ExternalResources = () => {
  useEffect(() => {
    // Load Google Font
    const fontLink = document.createElement('link');
    fontLink.href = 'https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap';
    fontLink.rel = 'stylesheet';
    document.head.appendChild(fontLink);

    // Load html2canvas
    const html2canvasScript = document.createElement('script');
    html2canvasScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
    html2canvasScript.async = true;
    document.body.appendChild(html2canvasScript);

    // Load jsPDF
    const jspdfScript = document.createElement('script');
    jspdfScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
    jspdfScript.async = true;
    document.body.appendChild(jspdfScript);

    // Add a body style to use the font
    document.body.style.fontFamily = "'Inter', sans-serif";

    // Cleanup function to remove elements on component unmount
    return () => {
      if (fontLink.parentNode) document.head.removeChild(fontLink);
      if (html2canvasScript.parentNode) document.body.removeChild(html2canvasScript);
      if (jspdfScript.parentNode) document.body.removeChild(jspdfScript);
    };
  }, []); // Empty dependency array ensures this runs only once

  return null; // This component doesn't render anything
};


// --- Main Application Component ---
export default function App() {
  const [completedSections, setCompletedSections] = useState({});
  const [progress, setProgress] = useState(0);
  const [userName, setUserName] = useState('');
  const [showCertificate, setShowCertificate] = useState(false);
  // --- NEW: State for font size ---
  const [baseFontSize, setBaseFontSize] = useState(16); // Default: 16px

  const totalSections = moduleData.sections.length;

  // --- NEW: Effect to update root font size on the <html> element ---
  // This allows all `rem` units in Tailwind to scale proportionally.
  useEffect(() => {
    document.documentElement.style.fontSize = `${baseFontSize}px`;
    // Cleanup function to reset the font size when the component unmounts
    return () => {
      document.documentElement.style.fontSize = '';
    };
  }, [baseFontSize]);

  useEffect(() => {
    const completedCount = Object.values(completedSections).filter(Boolean).length;
    setProgress((completedCount / totalSections) * 100);
  }, [completedSections, totalSections]);

  const handleToggleComplete = (sectionId) => {
    setCompletedSections(prev => ({
      ...prev,
      [sectionId]: !prev[sectionId]
    }));
  };
  
  // --- NEW: Functions to increase/decrease font size with limits ---
  const increaseFontSize = () => setBaseFontSize(size => Math.min(size + 2, 24)); // Max 24px
  const decreaseFontSize = () => setBaseFontSize(size => Math.max(size - 2, 12)); // Min 12px

  return (
    <>
      <ExternalResources />
      <div className="bg-gray-50 min-h-screen text-gray-800">
        <div className="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
          
          <header className="mb-10 p-8 bg-white rounded-2xl shadow-md border border-gray-200">
            <p className="text-sm font-bold text-indigo-600 uppercase tracking-wider mb-2">Go Beyond with AI</p>
            <h1 className="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-3 tracking-tight">{moduleData.title}</h1>
            <p className="text-lg text-gray-600 mb-6">{moduleData.goal}</p>
            <div className="flex flex-wrap items-center gap-x-4 gap-y-2">
              <span className="font-semibold text-gray-700">Tools Covered:</span>
              <div className="flex flex-wrap gap-2">
                {moduleData.tools.map(tool => (
                  <a key={tool.name} href={tool.url} target="_blank" rel="noopener noreferrer" className="px-3 py-1 bg-indigo-100 text-indigo-800 text-sm font-semibold rounded-full hover:bg-indigo-200 hover:text-indigo-900 transition-colors">
                    {tool.name}
                  </a>
                ))}
              </div>
            </div>
            {/* --- NEW: Font Size Controls --- */}
            <div className="mt-6 pt-4 border-t border-gray-200 flex items-center justify-between flex-wrap gap-4">
                <span className="font-semibold text-gray-700 text-base">Accessibility</span>
                <div className="flex items-center gap-3">
                    <span className="text-sm font-medium text-gray-600">Font Size</span>
                    <button 
                        onClick={decreaseFontSize} 
                        className="p-1 rounded-md bg-gray-200 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                        disabled={baseFontSize <= 12}
                        aria-label="Decrease font size"
                    >
                        <svg className="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20 12H4"></path></svg>
                    </button>
                    <span className="font-bold text-gray-800 w-12 text-center text-base tabular-nums">{baseFontSize}px</span>
                    <button 
                        onClick={increaseFontSize} 
                        className="p-1 rounded-md bg-gray-200 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                        disabled={baseFontSize >= 24}
                        aria-label="Increase font size"
                    >
                        <svg className="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4v16m8-8H4"></path></svg>
                    </button>
                </div>
            </div>
          </header>

          <div className="mb-10">
            <div className="flex justify-between items-center mb-2">
              <h2 className="text-lg font-bold text-gray-700">Your Progress</h2>
              <span className="text-lg font-bold text-indigo-600">{Math.round(progress)}%</span>
            </div>
            <div className="w-full bg-gray-200 rounded-full h-4">
              <div className="bg-gradient-to-r from-blue-500 to-indigo-600 h-4 rounded-full transition-all duration-500 ease-out" style={{ width: `${progress}%` }}></div>
            </div>
          </div>

          <main className="space-y-6">
            {moduleData.sections.map((section) => (
              <SectionCard key={section.id} section={section} isCompleted={!!completedSections[section.id]} onToggleComplete={() => handleToggleComplete(section.id)} />
            ))}
          </main>
          
          {progress === 100 && !showCertificate && (
              <div className="mt-12 p-8 bg-gradient-to-br from-green-400 to-blue-500 rounded-2xl shadow-lg text-center text-white">
                  <h3 className="text-3xl font-bold mb-2">Congratulations!</h3>
                  <p className="opacity-90 mb-6">You've completed the module. Enter your name to generate your certificate.</p>
                  <div className="flex flex-col sm:flex-row justify-center items-center gap-4">
                      <input
                          type="text"
                          placeholder="Enter your full name"
                          value={userName}
                          onChange={(e) => setUserName(e.target.value)}
                          className="px-4 py-2 border border-gray-300 rounded-lg w-full max-w-xs focus:ring-2 focus:ring-white outline-none text-gray-800"
                      />
                      <button
                          onClick={() => { if(userName) setShowCertificate(true); }}
                          disabled={!userName}
                          className="w-full sm:w-auto px-8 py-2.5 bg-white text-indigo-600 font-bold rounded-lg hover:bg-opacity-90 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed transition-all transform hover:scale-105"
                      >
                          Generate Certificate
                      </button>
                  </div>
              </div>
          )}
          
          <footer className="text-center mt-12 text-gray-500">
              <p>Designed by <a href="https://linkedin.com/in/fajarudinakbar" target="_blank" rel="noopener noreferrer" className="text-indigo-600 hover:underline font-semibold">Fajarudin Akbar</a></p>
          </footer>
        </div>

        {showCertificate && (
          <Certificate name={userName} onClose={() => setShowCertificate(false)} />
        )}
      </div>
    </>
  );
}

// --- Section Components ---
const SectionCard = ({ section, isCompleted, onToggleComplete }) => {
  const [isOpen, setIsOpen] = useState(true);
  return (
    <div className={`bg-white rounded-2xl shadow-md border transition-all duration-300 ${isCompleted ? 'border-green-300 ring-2 ring-green-200' : 'border-gray-200'}`}>
      <div className="p-5 sm:p-6 cursor-pointer" onClick={() => setIsOpen(!isOpen)}>
        <div className="flex justify-between items-center">
          <div className="flex items-center gap-4">
            <span className="text-3xl">{section.icon}</span>
            <h3 className="text-xl sm:text-2xl font-bold text-gray-800">{section.title}</h3>
          </div>
          <div className="flex items-center gap-4">
            {isCompleted && <Icon name="CheckCircle" className="w-7 h-7 text-green-500" />}
            <Icon name={isOpen ? "ChevronUp" : "ChevronDown"} className="w-6 h-6 text-gray-500" />
          </div>
        </div>
      </div>
      {isOpen && (
        <div className="px-5 sm:px-6 pb-6 border-t border-gray-200">
          <div className="mt-4 prose prose-indigo max-w-none prose-li:my-1 prose-p:my-2">
            {renderSectionContent(section)}
          </div>
          <div className="mt-6 text-right">
            <button onClick={(e) => { e.stopPropagation(); onToggleComplete(); }} className={`px-5 py-2 text-sm font-bold rounded-lg transition-colors transform hover:scale-105 ${isCompleted ? 'bg-green-100 text-green-800 hover:bg-green-200' : 'bg-gray-100 text-gray-800 hover:bg-gray-200'}`}>
              {isCompleted ? 'Completed!' : 'Mark as Complete'}
            </button>
          </div>
        </div>
      )}
    </div>
  );
};

const renderSectionContent = (section) => {
  if (section.isQuiz) { return <QuizSection section={section} />; }
  switch (section.title) {
    case "Understanding the Building Blocks":
      return (
        <div>
          {section.content.map((item, index) => (<p key={index}><strong>{item.term}:</strong> {item.definition}</p>))}
          {section.note && <p className="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-indigo-800">{section.note}</p>}
        </div>
      );
    case "Prompt Templates & Keywords":
      return (
        <div className="space-y-6">
          {section.content.map((template, index) => (
            <div key={index} className="p-4 border border-gray-200 rounded-lg bg-gray-50">
              <h4 className="font-bold text-lg text-indigo-700">{template.type}</h4>
              <p><strong>Best for:</strong> {template.use}</p>
              <div className="mt-2">
                <strong>Keywords:</strong>
                <div className="flex flex-wrap gap-2 mt-1">
                  {template.keywords.map(kw => <span key={kw} className="px-2.5 py-1 bg-gray-200 text-sm font-medium rounded-md">{kw}</span>)}
                </div>
              </div>
              <div className="mt-3">
                <strong>Template:</strong>
                <p className="mt-1 p-3 bg-gray-200 rounded-md font-mono text-sm text-gray-700">"{template.template}"</p>
              </div>
            </div>
          ))}
        </div>
      );
    default:
      return (<ul className="list-disc list-inside space-y-2">{section.content.map((item, index) => (<li key={index}>{item}</li>))}</ul>);
  }
};

const QuizSection = ({ section }) => {
  const [answers, setAnswers] = useState({});
  const handleAnswer = (id, value) => { setAnswers(prev => ({ ...prev, [id]: value })); };
  return (
    <div>
      <div className="space-y-4">
        {section.content.map(q => (
          <div key={q.id}>
            <p className="font-semibold">{q.question}</p>
            <div className="flex gap-4 mt-2">
              <button onClick={() => handleAnswer(q.id, true)} className={`px-4 py-1.5 rounded-md text-sm font-semibold ${answers[q.id] === true ? 'bg-green-500 text-white ring-2 ring-green-300' : 'bg-gray-200'}`}>Yes</button>
              <button onClick={() => handleAnswer(q.id, false)} className={`px-4 py-1.5 rounded-md text-sm font-semibold ${answers[q.id] === false ? 'bg-red-500 text-white ring-2 ring-red-300' : 'bg-gray-200'}`}>No</button>
            </div>
          </div>
        ))}
      </div>
      <p className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-800 font-semibold">{section.conclusion}</p>
    </div>
  );
};

// --- Certificate Component ---
const Certificate = ({ name, onClose }) => {
  const certificateRef = useRef(null);

  const handleDownloadPdf = () => {
    // Check if the libraries are loaded on the window object
    if (window.jspdf && window.html2canvas) {
        const { jsPDF } = window.jspdf;
        const input = certificateRef.current;
        if (input) {
            html2canvas(input, {
                scale: 2,
                useCORS: true,
                backgroundColor: null,
            }).then((canvas) => {
                const imgData = canvas.toDataURL('image/png');
                // The certificate is in landscape, so we set the PDF orientation accordingly.
                const pdf = new jsPDF({
                    orientation: 'landscape',
                    unit: 'px',
                    format: [canvas.width, canvas.height]
                });
                pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
                pdf.save(`Certificate-${name.replace(/\s+/g, '-')}.pdf`);
            });
        }
    } else {
        console.error("PDF generation libraries not loaded yet.");
        // You could show a user-friendly message here
    }
  };

  const currentDate = new Date().toLocaleDateString('en-US', {
    day: 'numeric',
    month: 'long',
    year: 'numeric'
  });
  
  const helveticaStyle = { fontFamily: "Helvetica, Arial, sans-serif" };
  const timesItalicStyle = { fontFamily: "'Times New Roman', Times, serif", fontStyle: 'italic' };
  const timesBoldStyle = { fontFamily: "'Times New Roman', Times, serif", fontWeight: 'bold' };
  const timesStyle = { fontFamily: "'Times New Roman', Times, serif" };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div className="absolute top-4 right-4 flex gap-2 print:hidden z-10">
          <button onClick={handleDownloadPdf} className="p-2 rounded-full bg-white hover:bg-gray-200 transition-colors shadow-lg">
            <Icon name="Download" className="w-6 h-6 text-gray-700" />
          </button>
          <button onClick={onClose} className="p-2 rounded-full bg-white hover:bg-gray-200 transition-colors shadow-lg">
            <Icon name="X" className="w-6 h-6 text-gray-700" />
          </button>
        </div>
      <div ref={certificateRef} className="bg-slate-100 p-2 rounded-lg shadow-2xl w-full max-w-4xl border-8 border-indigo-800 relative">
        <div className="text-center border-2 border-indigo-400 p-6 md:p-8">
          <h1 className="text-3xl sm:text-4xl md:text-5xl text-slate-800 tracking-wider" style={timesItalicStyle}>
            Certificate of Completion
          </h1>
          <p className="text-base sm:text-lg text-slate-600 mt-8" style={helveticaStyle}>
            This certificate is proudly presented to
          </p>
          <h2 className="text-4xl sm:text-5xl md:text-6xl text-slate-900 my-6" style={timesBoldStyle}>
            {name}
          </h2>
          <p className="text-base sm:text-lg text-slate-600" style={helveticaStyle}>
            for successfully completing the Go Beyond with AI Module:
          </p>
          <p className="text-lg sm:text-xl text-slate-700 font-semibold my-4" style={helveticaStyle}>
            Coding with Generative AI
          </p>
          <div className="flex flex-col sm:flex-row justify-between items-center mt-12 sm:mt-20 gap-8 sm:gap-0">
            <div className="text-center">
              <p className="border-t-2 border-slate-500 px-4 pt-2 text-lg" style={timesItalicStyle}>Fajarudin Akbar</p>
              <p className="text-sm text-slate-500 mt-1" style={helveticaStyle}>Instructor</p>
            </div>
            <div className="text-center">
              <p className="border-t-2 border-slate-500 px-4 pt-2 text-lg" style={timesStyle}>{currentDate}</p>
              <p className="text-sm text-slate-500 mt-1" style={helveticaStyle}>Date</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};
